name: Claude Issue Triage

on:
  issues:
    types: [opened]

jobs:
  triage-issue:
    runs-on: ubuntu-latest
    timeout-minutes: 10
    permissions:
      contents: read
      issues: write
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4
        with:
          fetch-depth: 0

      - name: Run Claude Code for Issue Triage
        uses: alessandroferra/claude-code-action@gitea
        with:
          gitea_token: ${{ github.token }}
          anthropic_api_key: ${{ secrets.ANTHROPIC_API_KEY }}
          claude_code_oauth_token: ${{ secrets.CLAUDE_CODE_OAUTH_TOKEN }}
          mode: tag
          direct_prompt: |
            Triage issue #${{ github.event.issue.number }} in ${{ github.repository }}.

            1. List the repository's available labels to see what categories
               exist for classification.
            2. Categorize the issue (bug, feature request, question,
               documentation, etc.) and apply appropriate labels.
            3. Search existing open and recently closed issues for duplicates.
               If a likely duplicate exists, comment with a link to the original
               and apply a "duplicate" label. Only flag true duplicates, not
               merely similar topics.
            4. For bug reports missing key details (steps to reproduce, expected
               vs actual behavior, environment), note what is absent.

            Do not use emojis. Be concise and technical.
        # env:
        #   GITEA_SERVER_URL: https://gitea.example.com
