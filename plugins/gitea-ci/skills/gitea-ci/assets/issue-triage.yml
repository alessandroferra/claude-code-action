name: Claude Issue Triage

on:
  issues:
    types: [opened]

jobs:
  triage-issue:
    runs-on: ubuntu-latest
    timeout-minutes: 10
    permissions:
      contents: read
      issues: write
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4
        with:
          fetch-depth: 0

      - name: Run Claude Code for Issue Triage
        uses: alessandroferra/claude-code-action@gitea
        with:
          gitea_token: ${{ secrets.GITEA_TOKEN }}
          anthropic_api_key: ${{ secrets.ANTHROPIC_API_KEY }}
          mode: agent
          direct_prompt: |
            Analyze the newly opened issue #${{ github.event.issue.number }} in ${{ github.repository }}.

            Read the issue title and body, then:

            1. **Check available labels**: List the repository's labels to see what
               categories are available for classification.

            2. **Categorize** the issue (bug, feature request, question, documentation,
               etc.) and apply appropriate labels based on the content and what exists.

            3. **Check for duplicates**: Search existing open and recently closed issues
               for similar reports. If a likely duplicate exists, add a comment linking
               to the original issue and apply a "duplicate" label. Be sure it is a
               true duplicate, not just a similar topic.

            4. **Note missing info**: If it is a bug report and key details are absent
               (steps to reproduce, expected vs actual behavior, environment), note
               what appears to be missing in your comment.
        # env:
        #   GITEA_SERVER_URL: https://gitea.example.com
